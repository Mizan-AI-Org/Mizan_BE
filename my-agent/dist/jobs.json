[
  {
    "name": "health-check-dev",
    "version": "1.0.0",
    "description": "System health monitoring",
    "context": "Runs every 5 minutes to check API health, database connectivity, and service availability. \" +\n           \"Logs health metrics and can trigger alerts if issues are detected.",
    "schedule": {
      "type": "interval",
      "seconds": 300
    },
    "timeout": 30,
    "execute": "async () => {\n    console.log('❤️ Running health check...');\n    const checks: any = {};\n\n    // Resource utilization metrics\n    const memory = process.memoryUsage();\n    const loadAvg = os.loadavg();\n    const uptime = process.uptime();\n\n    const systemMetrics = {\n      rss: memory.rss,\n      heapTotal: memory.heapTotal,\n      heapUsed: memory.heapUsed,\n      external: (memory as any).external ?? 0,\n      arrayBuffers: (memory as any).arrayBuffers ?? 0,\n      loadAvg1m: loadAvg[0],\n      loadAvg5m: loadAvg[1],\n      loadAvg15m: loadAvg[2],\n      uptimeSeconds: uptime,\n      timestamp: new Date().toISOString()\n    };\n\n    // Check 1: Database connectivity\n    try {\n      const testQuery = await Data.get('health-checks', {}, 1, 1);\n      checks.database = {\n        status: 'healthy',\n        responseTime: Date.now()\n      };\n    } catch (error) {\n      checks.database = {\n        status: 'unhealthy',\n        error: String(error)\n      };\n    }\n\n    // Check 2: Products API\n    try {\n      const startTime = Date.now();\n      await Products.get(1, 1);\n      const responseTime = Date.now() - startTime;\n      \n      checks.productsApi = {\n        status: 'healthy',\n        responseTime: `${responseTime}ms`\n      };\n    } catch (error) {\n      checks.productsApi = {\n        status: 'unhealthy',\n        error: String(error)\n      };\n    }\n\n    // Determine overall health\n    const allHealthy = Object.values(checks).every((check: any) => check.status === 'healthy');\n    const overallStatus = allHealthy ? 'healthy' : 'degraded';\n\n    // Log health check result\n    await Data.create('health-checks', {\n      status: overallStatus,\n      checks,\n      metrics: systemMetrics,\n      timestamp: new Date().toISOString()\n    });\n\n    // Alerting: write a system-alert when degraded\n    if (!allHealthy) {\n      console.warn('⚠️ System health degraded:', checks);\n      try {\n        await Data.create('system-alerts', {\n          type: 'health-degraded',\n          severity: 'high',\n          message: 'System health degraded – see health-checks for details',\n          checks,\n          metrics: systemMetrics,\n          createdAt: new Date().toISOString()\n        });\n      } catch (err) {\n        console.error('Failed to record system alert:', err);\n      }\n    }\n\n    return {\n      status: overallStatus,\n      checks,\n      metrics: systemMetrics,\n      timestamp: new Date().toISOString()\n    };\n  }",
    "executeFunction": "async () => {\n    console.log('❤️ Running health check...');\n    const checks: any = {};\n\n    // Resource utilization metrics\n    const memory = process.memoryUsage();\n    const loadAvg = os.loadavg();\n    const uptime = process.uptime();\n\n    const systemMetrics = {\n      rss: memory.rss,\n      heapTotal: memory.heapTotal,\n      heapUsed: memory.heapUsed,\n      external: (memory as any).external ?? 0,\n      arrayBuffers: (memory as any).arrayBuffers ?? 0,\n      loadAvg1m: loadAvg[0],\n      loadAvg5m: loadAvg[1],\n      loadAvg15m: loadAvg[2],\n      uptimeSeconds: uptime,\n      timestamp: new Date().toISOString()\n    };\n\n    // Check 1: Database connectivity\n    try {\n      const testQuery = await Data.get('health-checks', {}, 1, 1);\n      checks.database = {\n        status: 'healthy',\n        responseTime: Date.now()\n      };\n    } catch (error) {\n      checks.database = {\n        status: 'unhealthy',\n        error: String(error)\n      };\n    }\n\n    // Check 2: Products API\n    try {\n      const startTime = Date.now();\n      await Products.get(1, 1);\n      const responseTime = Date.now() - startTime;\n      \n      checks.productsApi = {\n        status: 'healthy',\n        responseTime: `${responseTime}ms`\n      };\n    } catch (error) {\n      checks.productsApi = {\n        status: 'unhealthy',\n        error: String(error)\n      };\n    }\n\n    // Determine overall health\n    const allHealthy = Object.values(checks).every((check: any) => check.status === 'healthy');\n    const overallStatus = allHealthy ? 'healthy' : 'degraded';\n\n    // Log health check result\n    await Data.create('health-checks', {\n      status: overallStatus,\n      checks,\n      metrics: systemMetrics,\n      timestamp: new Date().toISOString()\n    });\n\n    // Alerting: write a system-alert when degraded\n    if (!allHealthy) {\n      console.warn('⚠️ System health degraded:', checks);\n      try {\n        await Data.create('system-alerts', {\n          type: 'health-degraded',\n          severity: 'high',\n          message: 'System health degraded – see health-checks for details',\n          checks,\n          metrics: systemMetrics,\n          createdAt: new Date().toISOString()\n        });\n      } catch (err) {\n        console.error('Failed to record system alert:', err);\n      }\n    }\n\n    return {\n      status: overallStatus,\n      checks,\n      metrics: systemMetrics,\n      timestamp: new Date().toISOString()\n    };\n  }",
    "code": "H4sIAAAAAAAAE6VWUW/jNgx+z69QjSGQANWX3LYbYEMpMvQ67GFrsdw9tcWdYtOxO1vyJDqp4fi/D5LjNO2C24A9BBCpj+QnMiRNpW1VQuiTXjMiFqSbEPLuHfn4DEmDQDAHsm5UWkJKnvSaJDqFCSFbaUgqbtdPkGCYGJAIsdMloy6FrFBwZ3QNBlt/1453G8DbnRrvrsEmpqhRG49qzqN+lxVYD9icAO6MRo1tDbcZr0d9PSrDXNoTF956JShwZGLRZdpQp5GkUARZQoFL3m0AI7yXjxxUU4GR6xKii1nPel56Sy65dtZFRnE6dVF0RlCIQPvgwX5/ossalWChVcBcsBKQGKIz0lBk7KIOE1mWFLhh06m5EEJOp46EGUhQJhZ4b14ToVq0FLlhbL/X4ctNz2ID2BhFoPfP3B3IMrGgUsCFUE1ZXqV0Q4GxqOt5SXG/vwD3C798AfubTpsSrhIqeZBCJpsSA95tZdlABG+TEUkOjPFrAWJR0oR2PQ9enBztHJQD84SWouvjFV3y7uDdPzDrWVx5oxCea23Qimu6HCwKsaMG/moKAzTQNmCMb4X/szrLLtHK6hLCUm9o8NC8/+nDDw/NzcfZDfmjUapQG5KDLDEnSQ7Jn2EYBix2FQDR9RxFbXQC1oYVVNq0n63cAGVciiI88AtLLVO53VDG9RHd1FhUDmhEZ6yNMDTW8hxk/UmjLCMMj2ev/WwhPSjdkcMzglEeOB6vrmZcGiPbn5ssA+N8noru2jFZbjfzKpL3s8dR/NGJ86M49/L7Rz5wXEGiVWojzZ1kUVZ1pGBHriUCZSHqX1e3KzSF2lDWx2jaziXHCrmTBTqUdP1FgyGJlz6JNuBdz+d8zmIIU4lyLS2IzqLExkYHaBtwA7bWysKnooLIBQyV3lHW94nEJKeWdefMG3V0AMZoEx3oWdb3L/xe3MUD1Tuj0yZB6+l6bg5YnQAvbQxuKHjYsi7+jfHX77qqr+zXV3zP2n+LsmOhxpHk+8FSYCFswbTUioUNBy9CiCMPxnOhro5iFKSwMTKFNIiLjJ6UZpi4/6zOgVjOB00EvAI0RWIj81/+B4xfKHbsrJ00yrfWh+Xs0Fqr1iJUY2eN7KLAdbmr0RmK1ptcyhIMOopuPI6Zvzy+j1uXmALbKMiLTR7wCqzrySg4H5I8NO9n8++JBSCvkkAybUgKKIvSBufSMPBKl/iNNLwUfsyFLy8NbmThFiFqYiDRJiXD64h/XRRwV/hhEP/fUvQ8E9t4MiFk2Me/APpdDIe9PK4WkhldkcPwnBDiCOOIuhlBgryesuOQI/v9m5v4GHH8AnBbf1dg7g+FsihVAqSWRlaAYCaEHFbPUPw3of13RTzp2d/xSDC1aAgAAA=="
  },
  {
    "name": "agent-verification-dev",
    "version": "1.0.0",
    "description": "End-to-end verification of core agent workflows",
    "context": "Runs periodically to validate data access, product API, and webhook reachability. \" +\n    \"Captures processing time, success flags, and error messages for monitoring.",
    "schedule": {
      "type": "interval",
      "seconds": 900
    },
    "timeout": 60,
    "execute": "async () => {\n    const startedAt = Date.now();\n    const results: any = { steps: [] };\n\n    // Step 1: Data access\n    try {\n      const res = await Data.get(\"user-events\", {}, 1, 1);\n      results.steps.push({\n        name: \"data-access\",\n        success: !!res.success,\n        count: Array.isArray(res.data) ? res.data.length : 0,\n      });\n    } catch (err) {\n      results.steps.push({ name: \"data-access\", success: false, error: String(err) });\n    }\n\n    // Step 2: Products API\n    try {\n      const res = await Products.get(1, 1);\n      results.steps.push({ name: \"products-api\", success: !!res.success });\n    } catch (err) {\n      results.steps.push({ name: \"products-api\", success: false, error: String(err) });\n    }\n\n    // Overall status\n    const allOk = results.steps.every((s: any) => s.success);\n    results.status = allOk ? \"ok\" : \"issues\";\n    results.durationMs = Date.now() - startedAt;\n    results.timestamp = new Date().toISOString();\n\n    // Persist verification result\n    await Data.create(\"agent-verification\", results);\n\n    // Emit alert record if issues detected\n    if (!allOk) {\n      await Data.create(\"system-alerts\", {\n        type: \"agent-verification-failed\",\n        severity: \"medium\",\n        message: \"Agent verification detected issues in one or more steps\",\n        details: results.steps,\n        createdAt: new Date().toISOString(),\n      });\n    }\n\n    return results;\n  }",
    "executeFunction": "async () => {\n    const startedAt = Date.now();\n    const results: any = { steps: [] };\n\n    // Step 1: Data access\n    try {\n      const res = await Data.get(\"user-events\", {}, 1, 1);\n      results.steps.push({\n        name: \"data-access\",\n        success: !!res.success,\n        count: Array.isArray(res.data) ? res.data.length : 0,\n      });\n    } catch (err) {\n      results.steps.push({ name: \"data-access\", success: false, error: String(err) });\n    }\n\n    // Step 2: Products API\n    try {\n      const res = await Products.get(1, 1);\n      results.steps.push({ name: \"products-api\", success: !!res.success });\n    } catch (err) {\n      results.steps.push({ name: \"products-api\", success: false, error: String(err) });\n    }\n\n    // Overall status\n    const allOk = results.steps.every((s: any) => s.success);\n    results.status = allOk ? \"ok\" : \"issues\";\n    results.durationMs = Date.now() - startedAt;\n    results.timestamp = new Date().toISOString();\n\n    // Persist verification result\n    await Data.create(\"agent-verification\", results);\n\n    // Emit alert record if issues detected\n    if (!allOk) {\n      await Data.create(\"system-alerts\", {\n        type: \"agent-verification-failed\",\n        severity: \"medium\",\n        message: \"Agent verification detected issues in one or more steps\",\n        details: results.steps,\n        createdAt: new Date().toISOString(),\n      });\n    }\n\n    return results;\n  }",
    "code": "H4sIAAAAAAAAE41UTY/bOAy951coPgQSoLg7VwdKMcB0F3top0CPg6JgZDrR1JYMkU5qOP7vhZxkmg4yaE8SxEc+PvFDAvXeCvkcNkqYtRhmQrx7Jz78QNsxCt6h2HS+rLEUz2EjbChxJsQeorDmcfOMlvMSK+fxcwwtRu5XyeYvti3y48FfbA9INrqWQ5xQ7jbqEzRIE6C7ANoYOHDfYr4DuoJOqGAka1JmPVQhyvQCwnlBykrWoIctckFP8FWj7xqMsKmxmP8zqlG3k6cGjcnbVZIWi8QSKkHGZGEiz47Hq7eq85Zd8JlKZDWyiCJUwklSat7lFupaso5qsYhzY2CxSEnEUxJSmTU9xd8TkWi8JB2VOh4x/2UZ1Soid9ELHieZpWGzbqWVw6izb9+QPoayqzHTwx7q7iRJs5qwvRnGVZC9HkqsoKtP3M2oVs3klOOPNkQmU8r+5LE1UyMk2JBUsXkAxtyHg1SazECMLRVPX8cVx35CoIEDOBYPwJAqKLOOMC5xj54p08Oo7/SdWlE+ueZtRzs5eGiwyEpgWIK1SJRp6qZLMZ9jfr5rGzrPxX2M0OeOplNintzU+9OZ1+i3vCtSHS2w3UlUw99z3WmMMcTiC0fntxLVqMbXwj7HUHaWaRL3ppb2jFpC626K+VOCbwS4lWHKDswlCO4x9hLN+oXqpWUSBLgjA++z8D0rMkfUYfqAvOwipAb+SFcVXrKmnF2DxNC0xuMhlRWlyjn8/+XxnIPSVxW3ERMigy16Xu4xusrZKXKmSWk4Hm+AqSfGZgk1xqlH0mAVN0IsK3A1lpmmJNJxX2QNlq5rMt0gEWyxyO6Tl7j2EiUyWsZSnOSmLRA8ihBFEyKK6dsyXSKDq6k4/6M+JVfec/GW7lFpGnVjtqvZTIjThvwvDckOBZ435WUxiCqGRpznayaEDZ74gvr3AjLi90HMz3MqjsdXltUL42Unpz18cLybLs4Tg7coWojQIGOcCXHuglMBXlFPm341G9VPOUmPrfoFAAA="
  }
]