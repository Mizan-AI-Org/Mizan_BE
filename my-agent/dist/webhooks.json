[
  {
    "name": "forecasting-events",
    "version": "1.0.0",
    "description": "Processes forecasting data and generates predictive insights",
    "context": "This webhook receives historical data and external factors to generate accurate forecasts \" +\n        \"for inventory, staffing, and revenue. It helps optimize procurement and reduce waste.",
    "querySchema": {
      "type": "object",
      "properties": {
        "forecastType": {
          "type": "string",
          "enum": [
            "demand",
            "inventory",
            "staffing",
            "revenue"
          ]
        },
        "timeHorizon": {
          "type": "string",
          "enum": [
            "daily",
            "weekly",
            "monthly"
          ]
        }
      },
      "additionalProperties": false
    },
    "headerSchema": {
      "type": "object",
      "properties": {
        "x-api-key": {
          "type": "string"
        },
        "x-role": {
          "type": "string",
          "enum": [
            "analyst",
            "manager"
          ]
        },
        "x-forecast-source": {
          "type": "string"
        },
        "content-type": {
          "type": "string"
        }
      },
      "required": [
        "x-api-key",
        "x-role"
      ],
      "additionalProperties": false
    },
    "bodySchema": {
      "type": "object",
      "properties": {
        "eventType": {
          "type": "string",
          "enum": [
            "forecast_generated",
            "trend_detected",
            "anomaly_detected",
            "reorder_alert",
            "capacity_warning",
            "demand_spike",
            "inventory_optimization",
            "staffing_recommendation",
            "seasonal_pattern",
            "forecast_accuracy_check"
          ]
        },
        "forecastPeriod": {
          "type": "object",
          "properties": {
            "startDate": {
              "type": "string"
            },
            "endDate": {
              "type": "string"
            },
            "granularity": {
              "type": "string",
              "enum": [
                "hourly",
                "daily",
                "weekly"
              ]
            }
          },
          "required": [
            "startDate",
            "endDate",
            "granularity"
          ],
          "additionalProperties": false
        },
        "predictions": {
          "type": "object",
          "properties": {
            "covers": {
              "type": "number"
            },
            "revenue": {
              "type": "number"
            },
            "avgCheckSize": {
              "type": "number"
            },
            "peakHours": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "topItems": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "itemId": {
                    "type": "string"
                  },
                  "itemName": {
                    "type": "string"
                  },
                  "predictedQuantity": {
                    "type": "number"
                  },
                  "confidence": {
                    "type": "number"
                  }
                },
                "required": [
                  "itemId",
                  "itemName",
                  "predictedQuantity",
                  "confidence"
                ],
                "additionalProperties": false
              }
            },
            "staffingNeeds": {
              "type": "object",
              "properties": {
                "servers": {
                  "type": "number"
                },
                "kitchen": {
                  "type": "number"
                },
                "support": {
                  "type": "number"
                }
              },
              "required": [
                "servers",
                "kitchen",
                "support"
              ],
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "inventoryAlerts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "itemId": {
                "type": "string"
              },
              "itemName": {
                "type": "string"
              },
              "currentStock": {
                "type": "number"
              },
              "predictedUsage": {
                "type": "number"
              },
              "reorderPoint": {
                "type": "number"
              },
              "recommendedOrder": {
                "type": "number"
              },
              "urgency": {
                "type": "string",
                "enum": [
                  "low",
                  "medium",
                  "high",
                  "critical"
                ]
              }
            },
            "required": [
              "itemId",
              "itemName",
              "currentStock",
              "predictedUsage",
              "reorderPoint",
              "recommendedOrder",
              "urgency"
            ],
            "additionalProperties": false
          }
        },
        "trends": {
          "type": "object",
          "properties": {
            "direction": {
              "type": "string",
              "enum": [
                "up",
                "down",
                "stable"
              ]
            },
            "magnitude": {
              "type": "number"
            },
            "category": {
              "type": "string"
            },
            "drivers": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "required": [
            "direction",
            "magnitude",
            "category"
          ],
          "additionalProperties": false
        },
        "anomaly": {
          "type": "object",
          "properties": {
            "metric": {
              "type": "string"
            },
            "expectedValue": {
              "type": "number"
            },
            "actualValue": {
              "type": "number"
            },
            "deviation": {
              "type": "number"
            },
            "severity": {
              "type": "string",
              "enum": [
                "minor",
                "moderate",
                "severe"
              ]
            }
          },
          "required": [
            "metric",
            "expectedValue",
            "actualValue",
            "deviation",
            "severity"
          ],
          "additionalProperties": false
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "dataQuality": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "externalFactors": {
          "type": "object",
          "properties": {
            "weather": {
              "type": "string"
            },
            "events": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "holidays": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "competitorActivity": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "metadata": {
          "type": "object",
          "additionalProperties": {}
        },
        "timestamp": {
          "type": "string"
        }
      },
      "required": [
        "eventType",
        "forecastPeriod",
        "confidence",
        "timestamp"
      ],
      "additionalProperties": false
    },
    "execute": "async ({ query, headers, body }) => {\n        console.log(`ðŸ“Š [Forecasting] ${body.eventType} - Confidence: ${(body.confidence * 100).toFixed(1)}%`);\n\n        const expectedKey = process.env.WEBHOOK_API_KEY;\n        if (!expectedKey) {\n            throw new Error('API key is not configured in the environment variables');\n        }\n        if (headers['x-api-key'] !== expectedKey) {\n            throw new Error('Unauthorized: Invalid API key');\n        }\n\n        const role = headers['x-role'];\n        const eventPermissions: Record<string, string[]> = {\n            forecast_generated: ['analyst', 'manager'],\n            trend_detected: ['analyst', 'manager'],\n            anomaly_detected: ['analyst', 'manager'],\n            reorder_alert: ['manager'],\n            capacity_warning: ['manager'],\n            demand_spike: ['manager'],\n            inventory_optimization: ['analyst', 'manager'],\n            staffing_recommendation: ['manager'],\n            seasonal_pattern: ['analyst', 'manager'],\n            forecast_accuracy_check: ['analyst', 'manager']\n        };\n        const allowedRoles = eventPermissions[body.eventType];\n        if (allowedRoles && !allowedRoles.includes(role)) {\n            throw new Error(`Forbidden: role ${role} not permitted for event ${body.eventType}`);\n        }\n\n        const start = Date.now();\n        const module = new ForecastingModule();\n        const { actionTaken, requiresAction, priority, recommendations } = module.processEvent({\n            eventType: body.eventType as any,\n            forecastPeriod: body.forecastPeriod,\n            predictions: body.predictions,\n            inventoryAlerts: body.inventoryAlerts,\n            trends: body.trends,\n            anomaly: body.anomaly,\n            confidence: body.confidence,\n            dataQuality: body.dataQuality,\n            externalFactors: body.externalFactors\n        });\n\n        console.log(`   ðŸ“‹ Action: ${actionTaken}`);\n\n        // Store forecasting event with insights\n        const eventData = {\n            ...body,\n            forecastType: query?.forecastType,\n            timeHorizon: query?.timeHorizon,\n            source: headers['x-forecast-source'] || 'system',\n            actionTaken,\n            requiresAction,\n            priority,\n            recommendations,\n            receivedAt: new Date().toISOString(),\n            processed: true\n        };\n\n        // Performance monitoring\n        const latencyMs = Date.now() - start;\n        try {\n            await Data.create('module-metrics', {\n                module: 'forecasting',\n                eventType: body.eventType,\n                latencyMs,\n                timestamp: new Date().toISOString()\n            });\n        } catch (e) {\n            console.warn('Failed to record module metrics', e);\n        }\n\n        let result;\n        for (let attempt = 1; attempt <= 3; attempt++) {\n            try {\n                result = await Data.create(\n                    'forecasting-events',\n                    eventData,\n                    `${body.eventType} ${body.forecastPeriod.startDate} confidence:${(body.confidence * 100).toFixed(0)}%`\n                );\n                break;\n            } catch (err) {\n                console.error(`Attempt ${attempt}: Failed to store forecasting event`, err);\n                if (attempt === 3) throw new Error('Failed to store forecasting event after 3 attempts');\n                await new Promise(r => setTimeout(r, attempt * 500));\n            }\n        }\n\n        console.log(`âœ… Forecast processed: ${result.id}`);\n\n        // Calculate business impact\n        const potentialSavings = body.inventoryAlerts?.reduce((sum, item) =>\n            sum + (item.currentStock > item.reorderPoint ? 50 : 0), 0\n        ) || 0;\n\n        const revenueImpact = body.predictions?.revenue\n            ? (body.predictions.revenue * 0.15).toFixed(0) // 15% potential impact\n            : null;\n\n        return {\n            success: true,\n            eventId: result.id,\n            eventType: body.eventType,\n            actionTaken,\n            requiresAction,\n            priority,\n            confidence: `${(body.confidence * 100).toFixed(1)}%`,\n            recommendations,\n            insights: {\n                potentialSavings: potentialSavings > 0 ? `$${potentialSavings}` : null,\n                revenueImpact: revenueImpact ? `$${revenueImpact}` : null,\n                dataQuality: body.dataQuality ? `${(body.dataQuality * 100).toFixed(1)}%` : null\n            },\n            timestamp: new Date().toISOString()\n        };\n    }",
    "executeFunction": "async ({ query, headers, body }) => {\n        console.log(`ðŸ“Š [Forecasting] ${body.eventType} - Confidence: ${(body.confidence * 100).toFixed(1)}%`);\n\n        const expectedKey = process.env.WEBHOOK_API_KEY;\n        if (!expectedKey) {\n            throw new Error('API key is not configured in the environment variables');\n        }\n        if (headers['x-api-key'] !== expectedKey) {\n            throw new Error('Unauthorized: Invalid API key');\n        }\n\n        const role = headers['x-role'];\n        const eventPermissions: Record<string, string[]> = {\n            forecast_generated: ['analyst', 'manager'],\n            trend_detected: ['analyst', 'manager'],\n            anomaly_detected: ['analyst', 'manager'],\n            reorder_alert: ['manager'],\n            capacity_warning: ['manager'],\n            demand_spike: ['manager'],\n            inventory_optimization: ['analyst', 'manager'],\n            staffing_recommendation: ['manager'],\n            seasonal_pattern: ['analyst', 'manager'],\n            forecast_accuracy_check: ['analyst', 'manager']\n        };\n        const allowedRoles = eventPermissions[body.eventType];\n        if (allowedRoles && !allowedRoles.includes(role)) {\n            throw new Error(`Forbidden: role ${role} not permitted for event ${body.eventType}`);\n        }\n\n        const start = Date.now();\n        const module = new ForecastingModule();\n        const { actionTaken, requiresAction, priority, recommendations } = module.processEvent({\n            eventType: body.eventType as any,\n            forecastPeriod: body.forecastPeriod,\n            predictions: body.predictions,\n            inventoryAlerts: body.inventoryAlerts,\n            trends: body.trends,\n            anomaly: body.anomaly,\n            confidence: body.confidence,\n            dataQuality: body.dataQuality,\n            externalFactors: body.externalFactors\n        });\n\n        console.log(`   ðŸ“‹ Action: ${actionTaken}`);\n\n        // Store forecasting event with insights\n        const eventData = {\n            ...body,\n            forecastType: query?.forecastType,\n            timeHorizon: query?.timeHorizon,\n            source: headers['x-forecast-source'] || 'system',\n            actionTaken,\n            requiresAction,\n            priority,\n            recommendations,\n            receivedAt: new Date().toISOString(),\n            processed: true\n        };\n\n        // Performance monitoring\n        const latencyMs = Date.now() - start;\n        try {\n            await Data.create('module-metrics', {\n                module: 'forecasting',\n                eventType: body.eventType,\n                latencyMs,\n                timestamp: new Date().toISOString()\n            });\n        } catch (e) {\n            console.warn('Failed to record module metrics', e);\n        }\n\n        let result;\n        for (let attempt = 1; attempt <= 3; attempt++) {\n            try {\n                result = await Data.create(\n                    'forecasting-events',\n                    eventData,\n                    `${body.eventType} ${body.forecastPeriod.startDate} confidence:${(body.confidence * 100).toFixed(0)}%`\n                );\n                break;\n            } catch (err) {\n                console.error(`Attempt ${attempt}: Failed to store forecasting event`, err);\n                if (attempt === 3) throw new Error('Failed to store forecasting event after 3 attempts');\n                await new Promise(r => setTimeout(r, attempt * 500));\n            }\n        }\n\n        console.log(`âœ… Forecast processed: ${result.id}`);\n\n        // Calculate business impact\n        const potentialSavings = body.inventoryAlerts?.reduce((sum, item) =>\n            sum + (item.currentStock > item.reorderPoint ? 50 : 0), 0\n        ) || 0;\n\n        const revenueImpact = body.predictions?.revenue\n            ? (body.predictions.revenue * 0.15).toFixed(0) // 15% potential impact\n            : null;\n\n        return {\n            success: true,\n            eventId: result.id,\n            eventType: body.eventType,\n            actionTaken,\n            requiresAction,\n            priority,\n            confidence: `${(body.confidence * 100).toFixed(1)}%`,\n            recommendations,\n            insights: {\n                potentialSavings: potentialSavings > 0 ? `$${potentialSavings}` : null,\n                revenueImpact: revenueImpact ? `$${revenueImpact}` : null,\n                dataQuality: body.dataQuality ? `${(body.dataQuality * 100).toFixed(1)}%` : null\n            },\n            timestamp: new Date().toISOString()\n        };\n    }",
    "code": "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"
  },
  {
    "name": "staff-management-events",
    "version": "2.0.0",
    "description": "Manages staff scheduling, assignments, and performance tracking",
    "context": "This webhook optimizes staff operations by tracking assignments, monitoring workload, \" +\n        \"and ensuring efficient task distribution across the team.",
    "querySchema": {
      "type": "object",
      "properties": {
        "shift": {
          "type": "string",
          "enum": [
            "breakfast",
            "lunch",
            "dinner",
            "late_night"
          ]
        },
        "department": {
          "type": "string",
          "enum": [
            "foh",
            "boh",
            "bar",
            "management"
          ]
        }
      },
      "additionalProperties": false
    },
    "headerSchema": {
      "type": "object",
      "properties": {
        "x-api-key": {
          "type": "string"
        },
        "x-role": {
          "type": "string",
          "enum": [
            "server",
            "bartender",
            "host",
            "busser",
            "manager",
            "chef",
            "cook",
            "dishwasher"
          ]
        },
        "x-manager-id": {
          "type": "string"
        },
        "content-type": {
          "type": "string"
        }
      },
      "required": [
        "x-api-key",
        "x-role"
      ],
      "additionalProperties": false
    },
    "bodySchema": {
      "type": "object",
      "properties": {
        "eventType": {
          "type": "string",
          "enum": [
            "clock_in",
            "clock_out",
            "break_start",
            "break_end",
            "table_assigned",
            "table_transferred",
            "section_assigned",
            "task_assigned",
            "task_completed",
            "alert_triggered",
            "performance_logged",
            "tip_reported",
            "incident_reported",
            "shift_change"
          ]
        },
        "staffId": {
          "type": "string"
        },
        "staffName": {
          "type": "string"
        },
        "role": {
          "type": "string",
          "enum": [
            "server",
            "bartender",
            "host",
            "busser",
            "manager",
            "chef",
            "cook",
            "dishwasher"
          ]
        },
        "details": {
          "type": "object",
          "properties": {
            "tableIds": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "sectionId": {
              "type": "string"
            },
            "taskDescription": {
              "type": "string"
            },
            "taskPriority": {
              "type": "string",
              "enum": [
                "low",
                "medium",
                "high",
                "urgent"
              ]
            },
            "alertType": {
              "type": "string"
            },
            "alertMessage": {
              "type": "string"
            },
            "performanceMetric": {
              "type": "object",
              "properties": {
                "metric": {
                  "type": "string"
                },
                "value": {
                  "type": "number"
                },
                "target": {
                  "type": "number"
                }
              },
              "required": [
                "metric",
                "value"
              ],
              "additionalProperties": false
            },
            "tipAmount": {
              "type": "number"
            },
            "incidentDescription": {
              "type": "string"
            },
            "transferredTo": {
              "type": "string"
            },
            "breakDuration": {
              "type": "number"
            }
          },
          "additionalProperties": false
        },
        "metadata": {
          "type": "object",
          "additionalProperties": {}
        },
        "timestamp": {
          "type": "string"
        }
      },
      "required": [
        "eventType",
        "staffId",
        "staffName",
        "role",
        "timestamp"
      ],
      "additionalProperties": false
    },
    "execute": "async ({ query, headers, body }) => {\n        console.log(`ðŸ‘¥ [Staff] ${body.eventType} - ${body.staffName} (${body.role})`);\n\n        const expectedKey = process.env.WEBHOOK_API_KEY;\n        if (!expectedKey) {\n            throw new Error('API key is not configured in the environment variables');\n        }\n        if (headers['x-api-key'] !== expectedKey) {\n            throw new Error('Unauthorized: Invalid API key');\n        }\n\n        const role = headers['x-role'];\n        const eventPermissions: Record<string, string[]> = {\n            clock_in: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            clock_out: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            break_start: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            break_end: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            table_assigned: ['manager', 'host'],\n            table_transferred: ['manager', 'host'],\n            section_assigned: ['manager'],\n            task_assigned: ['manager'],\n            task_completed: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            alert_triggered: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            performance_logged: ['manager'],\n            tip_reported: ['server', 'bartender', 'manager'],\n            incident_reported: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            shift_change: ['manager']\n        };\n        const allowedRoles = eventPermissions[body.eventType];\n        if (allowedRoles && !allowedRoles.includes(role)) {\n            throw new Error(`Forbidden: role ${role} not permitted for event ${body.eventType}`);\n        }\n\n        const start = Date.now();\n        const module = new StaffManagementModule();\n        const { actionTaken, requiresManagerAttention, workloadImpact, workloadScore, recommendations } = module.processEvent({\n            eventType: body.eventType as any,\n            staffId: body.staffId,\n            staffName: body.staffName,\n            role: body.role,\n            details: body.details || {},\n            timestamp: body.timestamp\n        });\n\n        console.log(`   ðŸ“‹ Action: ${actionTaken}`);\n\n        // Performance monitoring\n        const latencyMs = Date.now() - start;\n        try {\n            await Data.create('module-metrics', {\n                module: 'staff-management',\n                eventType: body.eventType,\n                latencyMs,\n                timestamp: new Date().toISOString()\n            });\n        } catch (e) {\n            console.warn('Failed to record module metrics', e);\n        }\n\n        // Store staff event\n        const eventData = {\n            ...body,\n            shift: query?.shift,\n            department: query?.department,\n            managerId: headers['x-manager-id'],\n            actionTaken,\n            requiresManagerAttention,\n            workloadImpact,\n            workloadScore,\n            receivedAt: new Date().toISOString(),\n            processed: true\n        };\n\n        let result;\n        for (let attempt = 1; attempt <= 3; attempt++) {\n            try {\n                result = await Data.create(\n                    'staff-management-events',\n                    eventData,\n                    `${body.eventType} ${body.staffName} ${body.role}`\n                );\n                break;\n            } catch (err) {\n                console.error(`Attempt ${attempt}: Failed to store staff event`, err);\n                if (attempt === 3) throw new Error('Failed to store staff event after 3 attempts');\n                await new Promise(r => setTimeout(r, attempt * 500));\n            }\n        }\n\n        console.log(`âœ… Staff event processed: ${result.id}`);\n\n        // Return response with workload insights\n        return {\n            success: true,\n            eventId: result.id,\n            staffId: body.staffId,\n            staffName: body.staffName,\n            actionTaken,\n            workloadScore,\n            requiresManagerAttention,\n            recommendations,\n            timestamp: new Date().toISOString()\n        };\n    }",
    "executeFunction": "async ({ query, headers, body }) => {\n        console.log(`ðŸ‘¥ [Staff] ${body.eventType} - ${body.staffName} (${body.role})`);\n\n        const expectedKey = process.env.WEBHOOK_API_KEY;\n        if (!expectedKey) {\n            throw new Error('API key is not configured in the environment variables');\n        }\n        if (headers['x-api-key'] !== expectedKey) {\n            throw new Error('Unauthorized: Invalid API key');\n        }\n\n        const role = headers['x-role'];\n        const eventPermissions: Record<string, string[]> = {\n            clock_in: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            clock_out: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            break_start: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            break_end: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            table_assigned: ['manager', 'host'],\n            table_transferred: ['manager', 'host'],\n            section_assigned: ['manager'],\n            task_assigned: ['manager'],\n            task_completed: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            alert_triggered: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            performance_logged: ['manager'],\n            tip_reported: ['server', 'bartender', 'manager'],\n            incident_reported: ['server', 'bartender', 'host', 'busser', 'chef', 'cook', 'dishwasher', 'manager'],\n            shift_change: ['manager']\n        };\n        const allowedRoles = eventPermissions[body.eventType];\n        if (allowedRoles && !allowedRoles.includes(role)) {\n            throw new Error(`Forbidden: role ${role} not permitted for event ${body.eventType}`);\n        }\n\n        const start = Date.now();\n        const module = new StaffManagementModule();\n        const { actionTaken, requiresManagerAttention, workloadImpact, workloadScore, recommendations } = module.processEvent({\n            eventType: body.eventType as any,\n            staffId: body.staffId,\n            staffName: body.staffName,\n            role: body.role,\n            details: body.details || {},\n            timestamp: body.timestamp\n        });\n\n        console.log(`   ðŸ“‹ Action: ${actionTaken}`);\n\n        // Performance monitoring\n        const latencyMs = Date.now() - start;\n        try {\n            await Data.create('module-metrics', {\n                module: 'staff-management',\n                eventType: body.eventType,\n                latencyMs,\n                timestamp: new Date().toISOString()\n            });\n        } catch (e) {\n            console.warn('Failed to record module metrics', e);\n        }\n\n        // Store staff event\n        const eventData = {\n            ...body,\n            shift: query?.shift,\n            department: query?.department,\n            managerId: headers['x-manager-id'],\n            actionTaken,\n            requiresManagerAttention,\n            workloadImpact,\n            workloadScore,\n            receivedAt: new Date().toISOString(),\n            processed: true\n        };\n\n        let result;\n        for (let attempt = 1; attempt <= 3; attempt++) {\n            try {\n                result = await Data.create(\n                    'staff-management-events',\n                    eventData,\n                    `${body.eventType} ${body.staffName} ${body.role}`\n                );\n                break;\n            } catch (err) {\n                console.error(`Attempt ${attempt}: Failed to store staff event`, err);\n                if (attempt === 3) throw new Error('Failed to store staff event after 3 attempts');\n                await new Promise(r => setTimeout(r, attempt * 500));\n            }\n        }\n\n        console.log(`âœ… Staff event processed: ${result.id}`);\n\n        // Return response with workload insights\n        return {\n            success: true,\n            eventId: result.id,\n            staffId: body.staffId,\n            staffName: body.staffName,\n            actionTaken,\n            workloadScore,\n            requiresManagerAttention,\n            recommendations,\n            timestamp: new Date().toISOString()\n        };\n    }",
    "code": "H4sIAAAAAAAAE7VXbW/jxhH+7l8xJgyDm6wZXy/XAFTXhVP7WiG48wF2EASuIa/JobQVucvMDiWrNP97saRky7IvDQr3E8md952ZZ4ax9iubQfxbg7SSMEOdI3kJdy5fCVAn0O4B7AF89x2c32PWMALPEO4am5eYwxLvZs7NIXM57gEsNEGlLu7+hRknORbG4hdyNRKvRoE23tCmyBdLu6Gdoc/I1Oyo57p6neuzrtD3DAcbhpocO17VmMy032LtuS5VzJKEOmkLR3E4QTAWSFQxS5TtFDmla7yRaJsKSd+VmO4fd6KTp72kRGmDtCliOjwMVlwBpFTkeuPRw8PWWdHYjI2zkQjGSmTQ4Aq4ikmI/YMk02UZs9Ti8FDvK4WHh8EJPTgRC3VC1/q5I7FV45ikFuLhwSZPlE6MCLkhC9z1YZ4pViencRW3nYwmE/SfXN6UGMl2octmCEmy6Hk/q7YbXcafZZtjoZtysH3fiVHVCyV4Xztir87iz4OEU1mpvW9rchl6f75AyzGJdvCh1X3QV3qONo1KN51iHknC3xpD6D9pq6dIp8xoA1u6/04uHc1Lp/NxVeuMg8wyejy8zBxh+uFYEmauqtDmOsj59Dr65KxhR+BZFwWUuMDSRzddN9zBuerLOG77Mk5Zrus4JRkKOcUuJDJz1rsSk9JN49t/Nu27j9//+UMH15dB5w0ctJhgiO9qVWMHR/1Bby9UXgdx+CYXUnArRiHFVq2vJUG7SH45//EfFxc/TU6/jCc/nf86MkW8bwXPyC3B4hLOiRzF0emXMcxxBcaDdQyZs4WZNoR5KM7QW2gXhpyt0HJoKBOy7iMR9NF1dH+ka3M0x1V0s6/UK/p/trrhmSPzb8xTGNuFLk0Oa6vR4LhWvaYQTHQjC9VmpcvmE2PT68gjLZAiGd1pYrR5/z5znsNR433/nc2wCA/n5pGMcuNnS+1nPakash7dyEGpa/hNtd4R6vnEs6b/h160+Ztq5ZC9ifbeTC0G1RvSWt+Gg0lbXyDR60we+0Z7TVHQ4Oe/Q8lcVZfI+LaB6RKJJ0xmOkV6Y901UuGo0jbDyQAqz6My9YQwANXX7T5xG5uZHC3/V5H/yVU/MwVPspm2U9x2srveApOb0LvF4eF+kRiblU2OPtbiRevefnR0Z/IcbQqhNeGg1V0PEjVSZZgxh8IR9Hp34GqNSDN1phkT65axkFMVdDv5DKXN1+G53EXnegeZ8xfAvOjUNHk2G9pHn9It/2SPo+M8XSPqOJePyJpuoawMcacDzMocWZvSp5is3x4e2k6yqdCzruoUk8f3ToyeoTsADAD/tx87OO3DT+GgNZt7Wm7d09FsxLRq9VIbhjPNOskINWMcDUPxqEImk/lItsNBGvX+Hg3JDjgdydejLjWjzVaffLrc8jtkJZiPRcJufHlxyWTsNBad6DLN2Sz24nFWLTXZOPqoTdi22EFIAOUwOAKPnnnRhbDmqk2SBIeqTFkp25TlXxfO5HCcctIfyxxrTRzcfsnxRJPrUh7naT8r1p9HJg/N/5YFhWaB+Sl/9Vrkur4wD7uMzEabDcurdyP/F/V+5L/9VoQUZuqVJO7m6qhPj4/kXN7ujPydgf8472/FqJ8O6/Q0IuyEmwzh0Lsh6qoObem7FJ4S5tkRrteW3tStbIT0Sqn3L2f374iBLhgJ3oMeDIWNYIg2yH8hVxmP8USdeOQrU6FrOJ5I/82H42MhuvXKuLMB/emH4w9wuWXj6abhoM0Sk3e3Qra+ycJpun88lPk4TwPtD/f082p5WQFfrZ4XaPNHmqiT9+p8tPf42/J35GGtWv++bDZ1KMhVsF5496C/G95wfdwwKXi+GSfrxRkeHnYooxc/SkvDM+AZIYIPfaUZITwqZCQPcUB2bWH4nRB7AOssDWnd8eT1P7TRXif+AxOVpBfDDQAA"
  }
]